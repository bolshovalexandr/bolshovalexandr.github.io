{"version":3,"sources":["webpack:///webpack/bootstrap e8ae3866cdbc7077d9ae","webpack:///./src/js/main.js","webpack:///./src/js/storage.js"],"names":["formLogin","document","querySelector","formLoginBtn","listLogin","listLog","listLogBody","profile","profileName","profileTime","profileDirectory","profileExit","cleanStorage","sessionStorage","removeItem","setLocalStorage","loadedData","setItem","nickname","lastLogin","directory","token","hideFormShowProfile","classList","add","remove","hideProfileShowForm","getTocken","body","xhr","XMLHttpRequest","responseType","open","action","send","addEventListener","response","status","data","innerHTML","getItem","getLog","url","Date","now","forEach","item","index","ha_comment","evt","preventDefault","FormData","append","reset"],"mappings":"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","file":"script.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e8ae3866cdbc7077d9ae","import storage from './storage.js';\r\n\r\nstorage();\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/main.js","/*\r\n * email=donmixa@gmail.com password=Pass_c5fc\r\n */\r\n\r\nexport default function () {\r\n\r\n  const formLogin = document.querySelector('#form-login');\r\n  const formLoginBtn = formLogin.querySelector('BUTTON');\r\n  const listLogin = document.querySelector('#list-login-list');\r\n  const listLog = document.querySelector('#list-log-list');\r\n  const listLogBody = document.querySelector('#log-body');\r\n  const profile = document.querySelector('#profile');\r\n  const profileName = profile.querySelector('#profile-name');\r\n  const profileTime = profile.querySelector('#profile-time');\r\n  const profileDirectory = profile.querySelector('#profile-directory');\r\n  const profileExit = document.querySelector('#profile-exit');\r\n\r\n  // чистим хранилище\r\n  let cleanStorage = function () {\r\n    sessionStorage.removeItem('userNickname');\r\n    sessionStorage.removeItem('userLastLogin');\r\n    sessionStorage.removeItem('userToken');\r\n  };\r\n\r\n  // заполняем хранилище\r\n  let setLocalStorage = function (loadedData) {\r\n    sessionStorage.setItem('userNickname', loadedData.nickname);\r\n    sessionStorage.setItem('userLastLogin', loadedData.lastLogin);\r\n    sessionStorage.setItem('userDirectory', loadedData.directory);\r\n    sessionStorage.setItem('userToken', loadedData.token);\r\n  };\r\n\r\n  // спрятать форму, показать профиль\r\n  const hideFormShowProfile = function () {\r\n    formLogin.classList.add('d-none');\r\n    profile.classList.remove('d-none');\r\n    profileExit.classList.remove('invisible');\r\n  };\r\n\r\n  // спрятать профиль, показать форму\r\n  const hideProfileShowForm = function () {\r\n    formLogin.classList.remove('d-none');\r\n    profile.classList.add('d-none');\r\n    profileExit.classList.add('invisible');\r\n  };\r\n\r\n  // создаем запрос на токен\r\n  const getTocken = function (body) {\r\n\r\n    let xhr = new XMLHttpRequest();\r\n    xhr.responseType = 'json';\r\n    xhr.open('POST', formLogin.action, true);\r\n    xhr.send(body);\r\n\r\n    xhr.addEventListener('load', function () {\r\n      if (xhr.response.status === 200) {\r\n        formLoginBtn.classList.remove('btn-danger');\r\n        setLocalStorage(xhr.response.data);\r\n        hideFormShowProfile();\r\n        profileName.innerHTML = sessionStorage.getItem('userNickname');\r\n        profileTime.innerHTML = sessionStorage.getItem('userLastLogin');\r\n        profileDirectory.innerHTML = sessionStorage.getItem('userDirectory');\r\n      } else {\r\n        formLoginBtn.classList.add('btn-danger');\r\n      }\r\n\r\n    });\r\n  };\r\n\r\n  // создаем запрос на журнал\r\n  const getLog = function () {\r\n\r\n    let xhr = new XMLHttpRequest();\r\n    let body = 'position=0&count=50&token=' + sessionStorage.getItem('userToken');\r\n    let url = `https://lopos.bidone.ru/api/v1/lopos_directory/${sessionStorage.getItem('userDirectory')}/update_log/${Date.now()}/story`;\r\n\r\n    xhr.open('POST', url, true);\r\n    xhr.responseType = 'json';\r\n    xhr.send(body);\r\n\r\n    xhr.addEventListener('load', function () {\r\n\r\n      if (xhr.response.status === 281) {\r\n        listLogBody.innerHTML = '';\r\n        xhr.response.data.forEach(function (item, index) {\r\n          listLogBody.innerHTML += '<div>' + index + ' ' + item.ha_comment + '</div>';\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  // слушаем сабмит отправки логина/пароля\r\n  formLogin.addEventListener('submit', function (evt) {\r\n    evt.preventDefault();\r\n    let data = new FormData(formLogin);\r\n    data.append('deviceToken', '2222');\r\n    getTocken(data);\r\n  });\r\n\r\n  // слушаем кнопку \"Вход\"\r\n  listLogin.addEventListener('click', function () {\r\n    if (sessionStorage.getItem('userNickname')) {\r\n      hideFormShowProfile();\r\n    } else {\r\n      hideProfileShowForm();\r\n    }\r\n  });\r\n\r\n  // слушаем кнопку \"Выход\"\r\n  profileExit.addEventListener('click', function () {\r\n    hideProfileShowForm();\r\n    formLogin.reset();\r\n    cleanStorage();\r\n  });\r\n\r\n  // слушаем кнопку \"Журнал\"\r\n  listLog.addEventListener('click', function () {\r\n    if (sessionStorage.getItem('userNickname')) {\r\n      getLog();\r\n    } else {\r\n      listLogBody.innerHTML = 'Пожалуйста, зарегистрируйтесь...';\r\n    }\r\n  });\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/storage.js"],"sourceRoot":""}